/*! deebs 2014-11-08 */
!function(){function a(){function a(){for(var a=j.tableNames,b=a.length,c=[],d=0;b>d;d++)c.push(a[d].name);var e=G.response.getResponse("ok");return e.results=c,e}function b(b){var c=j.tableNames,d=c.length,e=G.data.isString(b);if(!e.error){e.message="This table name is ok.";for(var f=0;d>f;f++)if(c[f]&&b===c[f].name)switch(c[f].owner){case"root":g?(e=G.response.getResponse("warn"),e.message="To use this table name enable superUser and configure the system manually. This is not advised, nor documented.",d=f):(e=G.response.getResponse("error"),e.message="Table name already in use.",d=f);break;default:e=G.response.getResponse("error"),e.message="Table name already in use.",d=f}e=a()}return e}function c(a){var b=G.data.isArray(j[a]);return b}function l(a){var b=c(a);return b.error||(b.results=j[a]),b}function m(a){var b=c(a);if(!b.error){var d=j,e={};e.rowCount=d[a].length,b=G.response.getResponse("ok"),b.message="Success, table info returned.",b.results=[e]}return b}function n(a){var b=l(a);if(!b.error){var c=b.results.length;b.results=[c.toString()]}return b}function o(c){var d=b(c);if(!d.error){var f=/\s/g;if(c=c.replace(f,"")){var g={name:c,owner:e};j.tableNames.push(g),j[c]=[],d=a()}else d=G.response.getResponse("error"),d.message="Invalid table name specified.",d.results=[]}return d}function p(a){var b=c(a);if(!b.error)if("tableNames"!==a){delete j[a];var d=[],e=j.tableNames,f=e.length;if(f>1){for(var g=0;f>g;g++)e[g].name!==a&&d.push(e[g]);j.tableNames=d,b=G.response.getResponse("ok"),b.message="Success, table "+a+" removed",b.results=[]}}else b=G.response.getResponse("error"),b.message="This table cannot be removed.",b.results=[];return b}function q(a,b,c){var d=G.data.isObject(a);if(!d.error){c||(c=!1);for(var e in a)d=G.data.isFunction(a[e]),d.error||delete a[e];a[k.id]=b,a[k.lock]=c,d=G.response.getResponse("ok"),d.message="Success, record has been formatted.",d.results=[a]}return d}function r(a,b){var d=c(a);if(!d.error&&(d=G.data.isObject(b),!d.error&&(d=n(a),!d.error))){var e=d.get();d=G.data.copy(b),d.error||(console.log(d),b=d.get(),d=q(b,e,!1),d.error||(b=d.get(),j[a].push(b),d.message="Success, record added to "+a+"."))}return d}function s(a,b){var d=c(a),e=[];if(!d.error&&(d=G.data.isArray(b),!d.error)){var f=b.length;if(f>0){if(!d.error)for(var g=0;f>g;g++)d=r(a,b[g]),d.error||e.push(d.results[0]);d.results=e}else d=G.response.getResponse("error"),d.message="No records supplied.",d.results=[]}return d}function t(a,b,d){var e=c(a);if(!e.error&&(e=G.data.isString(b),!e.error))if(b=parseFloat(b),b||0===b){var f=j[a][b];if(f){if(e=G.data.copy(f),!e.error){if(f=e.results[0],d)for(var g in k){var h=k[g];delete f[h]}e=G.response.getResponse("ok"),e.results=[f],e.message="Success, record found."}}else e=G.response.getResponse("error"),e.message="The record could not be found."}else e=G.response.getResponse("error"),e.message="the record ID is improperly formatted.";return e}function u(a,b){var d=c(a);if(!d.error&&(d=G.data.isString(b),!d.error&&(b=parseFloat(b),b||0===b))){var e=j[a][b];e?e[k.lock]?(d=G.response.getResponse("error"),d.message="The record is locked and cannot be removed."):(j[a][b]=null,d=G.response.getResponse("ok"),d.results=[e],d.message="Success, record removed."):(d=G.response.getResponse("error"),d.message="The record could not be found.")}return d}function v(a,b){var d=[],e=c(a);if(!e.error&&(e=G.data.isArray(b),!e.error)){for(var f=b.length,g=0;f>g;g++)e=u(a,b[g]),e.error||d.push(e.results[0]);e=G.response.getResponse("success"),e.message="Records successfully removed.",e.results=d}return e}function w(a,b,d,e){var f=c(a),g=[];if(!f.error&&(f=G.data.isString(b),!f.error&&("*"===b&&(b="0",d=j[a].length.toString()),f=G.data.isString(d),!f.error))){var b=parseFloat(b),d=parseFloat(d)+1;if((b||0===b)&&d-1<=j[a].length)if(d>b){for(var h=d,i=b;h>i;i++)if(f=G.data.copy(j[a][i]),!f.error){var l=f.results[0];if(e)for(var m in k){var n=k[m];delete l[n]}g.push(l)}f=G.response.getResponse("ok"),f.message="Success, "+g.length+" retreived.",f.results=g}else f=G.response.getResponse("error"),f.message="Invalid range specified.",f.results=[];else f=G.response.getResponse("error"),f.message="Invalid range specified.",f.results=[]}return f}function x(a,b,d){var e=c(a);if(!e.error){e=G.data.isArray(b);var f=b.length,g=[];if(f>0){for(var h=0;f>h;h++){var i=parseFloat(b[h]);if(i||0===i){var e=t(a,b[h],d);e.error||g.push(e.results[0])}}g.length>0&&(e=G.response.getResponse("ok"),e.message="Success, records found.",e.results=g)}else e=G.response.getResponse("error"),e.message="No collection supplied."}return e}function y(a,b){var d=c(a);if(!d.error&&(d=G.data.isObject(b),!d.error&&(d=w(a,"*"),!d.error))){var e=d.results,f=e.length;if(f>0){for(var g=[],h=0;f>h;h++){var i=0,j=0;for(var k in b)j++,e[h][k]===b[k]&&i++;if(j>0&&i===j&&(d=G.data.copy(e[h]),!d.error)){var l=d.results[0];g.push(l)}}g.length>0?(d=G.response.getResponse("ok"),d.message="Success, "+g.length+" records found",d.results=g):(d=G.response.getResponse("error"),d.message="No records found.",d.results=[])}else d=G.response.getResponse("error"),d.message="The table searched is empty.",d.results=[]}return d}function z(a,b){var d=c(a);if(!d.error&&(d=G.data.isObject(b),!d.error&&(d=w(a,"*"),!d.error))){var e=d.results,f=[];if(e.length>0){for(var g=0;g<e.length;g++)if(e[g]&&(d=G.data.areLikeObjects(b,e[g]),!d.error&&(d=G.data.copy(e[g]),!d.error))){var h=d.results[0];f.push(h)}}else d=G.response.getResponse("error"),d.message="No like records found.",d.results=[];f.length>0?(d=G.response.getResponse("ok"),d.message="Success, like records found.",d.results=f):(d=G.response.getResponse("error"),d.message="No like records found.",d.results=[])}return d}function A(a){var b=c(a);if(!b.error&&(b=w(a,"*"),!b.error)){var d=b.results,e=d.length;if(e>0){for(var f=0;e>f;f++)if(b=G.data.copy(d[f]),!b.error){var g=b.results[0];if(delete g[k.id],delete g[k.lock],b=y(a,g),!b.error){var h=b.results,i=h[0][k.id];i=parseFloat(i),j[a][i][k.unique]=!0}}var l={};l[k.unique]=!0,b=y(a,l),b.message="Success, unique records found."}else b=G.response.getResponse("error"),b.message="Table contains no records. error 2",b.results=[]}return b}function B(a){var b=A(a);if(!b.error){for(var c=j[a],d=c.length,e=0,f=0;d>f;f++)c[f]&&!c[f][k.unique]&&(c[f]=null,e++);e?(b=G.response.getResponse("ok"),b.message="Success, "+e+" records removed.",b.results=[]):(b=G.response.getResponse("error"),b.message="No records were removed.",b.results=[])}return b}function C(a,b,c,d){var e,f=t(a,b);if(!f.error&&(e=f.results[0],e[k.lock]&&!d))return f=G.response.getResponse("error"),f.message="This record cannot be updated because it is locked.",f.results=[b],f;if(f=G.data.isObject(c),!f.error&&e){for(var g in c)f=G.data.isFunction(c[g]),f.error&&(e[g]=c[g]);var h=parseFloat(b);(h||0===h)&&(j[a][h]=e,f=G.response.getResponse("ok"),f.message="Success, record "+b+" updated.",f.results=[e])}return f}function D(){var b=a();if(!b.error){for(var c=b.results,e=0;e<c.length;e++)if(b=l(c[e]),!b.error){var f=JSON.stringify(b.results),g=d+"_"+c[e];localStorage.setItem(g,f)}b=G.response.getResponse("ok"),b.message="Success, database pickled.",b.results=[]}return b}function E(){var a=d+"_tableNames";a=JSON.parse(localStorage.getItem(a));var b=G.data.isArray(a);if(!b.error){for(var c=0;c<a.length;c++){var e=d+"_"+a[c].name,f=localStorage.getItem(e);f&&(e=e.replace(d+"_",""),alert(e),j[e]=JSON.parse(f))}b=G.response.getResponse("ok"),b.message="Success, database unpickled.",b.results=[j]}return b}function F(){return i.getTableNames=function(){var b=a();return h&&(b=b.error?!1:b.results,b&&1===b.length&&(b=b[0])),b},i.checkTableName=function(a){var c=b(a);return h&&(c=c.error?!1:c.results,c&&1===c.length&&(c=c[0])),c},i.createTable=function(a){var b=o(a);return h&&(b=b.error?!1:b.results,b&&1===b.length&&(b=b[0])),b},i.dropTable=function(a){var b=p(a);return h&&(b=b.error?!1:b.results,b&&1===b.length&&(b=b[0])),b},i.addRecord=function(a,b,c){var d=r(a,b,c);return h&&(d=d.error?!1:d.results,d&&1===d.length&&(d=d[0])),d},i.getRecord=function(a,b,c){var d=t(a,b,c);return h&&(d=d.error?!1:d.results,d&&1===d.length&&(d=d[0])),d},i.removeRecord=function(a,b){var c=u(a,b);return h&&(c=c.error?!1:c.results,c&&1===c.length&&(c=c[0])),c},i.removeRecords=function(a,b){var c=v(a,b);return h&&(c=c.error?!1:c.results,c&&1===c.length&&(c=c[0])),c},i.getRecords=function(a,b,c){var d=w(a,b,c);return h&&(d=d.error?!1:d.results,d&&1===d.length&&(d=d[0])),d},i.selectRecords=function(a,b){var c=y(a,b);return h&&(c=c.error?!1:c.results,c&&1===c.length&&(c=c[0])),c},i.getLikeRecords=function(a,b){var c=z(a,b);return h&&(c=c.error?!1:c.results,c&&1===c.length&&(c=c[0])),c},i.pickle=function(){var a=D();return h&&(a=a.error?!1:a.results,a&&1===a.length&&(a=a[0])),a},i.unPickle=function(){var a=E();return h&&(a=a.error?!1:a.results,a&&1===a.length&&(a=a[0])),a},i.getTableInfo=function(a){var b=m(a);return h&&(b=b.error?!1:b.results,b&&1===b.length&&(b=b[0])),b},i.addRecords=function(a,b){var c=s(a,b);return h&&(c=c.error?!1:c.results,c&&1===c.length&&(c=c[0])),c},i.getCollection=function(a,b,c){var d=x(a,b,c);return h&&(d=d.error?!1:d.results,d&&1===d.length&&(d=d[0])),d},i.getUnique=function(a){var b=A(a);return h&&(b=b.error?!1:b.results,b&&1===b.length&&(b=b[0])),b},i.deDupe=function(a){var b=B(a);return h&&(b=b.error?!1:b.results,b&&1===b.length&&(b=b[0])),b},i.updateRecord=function(a,b,c){var d=C(a,b,c);return h&&(d=d.error?!1:d.results,d&&1===d.length&&(d=d[0])),d},i.lockRecord=function(a,b){var c={};c[k.lock]=!0;var d=C(a,b,c);return h&&(d=d.error?!1:d.results,d&&1===d.length&&(d=d[0])),d},i.unlockRecord=function(a,b){var c={};c[k.lock]=!1;var d=C(a,b,c,!0);return h&&(d=d.error?!1:d.results,d&&1===d.length&&(d=d[0])),d},i.setOptions=function(a){var b=G.setOptions(a);return h&&(b=b.error?!1:b.results,b&&1===b.length&&(b=b[0])),b},i.extend=function(a,b){var c=G.extend(a,b);return h&&(c=c.error?!1:c.results,c&&1===c.length&&(c=c[0])),c},i}var G={};return G.response={getResponse:function(a){var b={};switch(a){case"warn":b.error=!0,b.errorType="warn";break;case"error":b.error=!0,b.errorType="error";break;default:b.error=!1,b.errorType=null}return b.getRecordId=function(){var a=!1,b=k.id,c=this.results;if(1===c.length){var d=G.data.isObject(c[0]);d.error||c[0][b]&&(a=c[0][b])}return a},b.get=function(){var a=!1,b=this.results;if(!this.error)switch(b.length){case 0:break;case 1:a=this.results[0];break;default:a=this.results}return a},b},wrap:function(a,b){var c=G.data.isString(b);return c.error&&(b=""),c=this.getResponse("ok"),c.message=b,c.results=[a],a||(c=this.getResponse("error"),c.message="Uh-oh, somethign went wrong",c.results=[a]),c}},G.setOptions=function(a){var b=this.data.isObject(a);return b.error||(b=this.data.isString(a.namesapce),b.error||(d=a.namespace||"deebs"),b=this.data.isString(a.user),b.error||(e=a.user||"admin"),b=this.data.isBoolean(a.superUser),b.error||(g=a.superUser||!1),b=this.data.isBoolean(a.debug),b.error||(f=a.debug||!1),b=this.data.isBoolean(a.easyMode),b.error||(h=a.easyMode||!1),this.init(),this.createAPI(),b=this.response.getResponse("ok"),b.message="Success, options set.",b.results=arguments),b},G.init=function(){g?this.initSuperUser():this.killSuperUser()},G.extend=function(a,b){var c=this.data.isString(b);return c.error||(c=this.data.isFunction(a),c.error||(i[b]?g?i[b]=a:(c=this.response.getResponse("error"),c.message=b+" already exist.",c.results=[b]):i[b]=a)),c},G.initSuperUser=function(){i.getSystem=function(){return G},i.getTables=function(){return j}},G.killSuperUser=function(){i.getSystem&&delete i.getSystem,i.getTables&&delete i.getTables},G.data={checktype:function(a){var b=G.response.getResponse("ok");try{var c,d=Object.prototype.toString.call(a);switch(d){case"[object Array]":c="array";break;case"[object Function]":c="function";break;case"[object Null]":c="null";break;case"[object Number]":c="number";break;case"[object Object]":c="object";break;case"[object RegExp]":c="regexp";break;case"[object String]":c="string";break;case"[object Boolean]":c="boolean";break;default:c="undefined"}b.results=[c]}catch(e){b=G.response.getResponse("error"),b.message=e}return b},isArray:function(a){var b=this.checktype(a);return b.error||"array"!==b.results[0]?(b=G.response.getResponse("error"),b.message="Item not is an array."):(b=G.response.getResponse("ok"),b.message="Success, item is an array."),b.results=[a],b},isObject:function(a){var b=this.checktype(a);return b.error||"object"!==b.results[0]?(b=G.response.getResponse("error"),b.message="item is not an object."):(b=G.response.getResponse("ok"),b.message="Success, item is an object."),b.results=[a],b},isString:function(a){var b=this.checktype(a);return b.error||"string"!==b.results[0]?(b=G.response.getResponse("error"),b.message="item is not a string."):(b=G.response.getResponse("ok"),b.message="Success, item is a string."),b.results=[a],b},isNumber:function(a){var b=this.checktype(a);return b.error||"number"!==b.results[0]?(b=G.response.getResponse("error"),b.message="item is not a number."):(b=G.response.getResponse("ok"),b.message="Success, item is a number."),b.results=[a],b},isFunction:function(a){var b=this.checktype(a);return b.error||"function"!==b.results[0]?(b=G.response.getResponse("error"),b.message="Item is not a function."):(b=G.response.getResponse("ok"),b.message="Success, item is a function."),b.results=[a],b},isBoolean:function(a){var b=this.checktype(a);return b.error||"boolean"!==b.results[0]?(b=G.response.getResponse("error"),b.message="item is not a boolean."):(b=G.response.getResponse("ok"),b.message="Success, item is a boolean."),b.results=[a],b},areLikeNumbers:function(a,b){var c=this.isNumber(a);if(!c.error&&(c=this.isNumber(b),!c.error)){var d=0;if(a>b){var e=a-.1*a;b>=e&&(d+=100)}else{var f=b-(b+.1);a>=f&&(d+=100)}d?(c=G.response.getResponse("ok"),c.message="The numbers are similar",c.results=arguments):(c=G.response.getResponse("error"),c.message="The numbers are not similar",c.results=arguments)}return c},areLikeStrings:function(a,b){var c=this.isString(a);if(c.error||(c=this.isString(b)),!c.error){var d=0,e=a.length>b.length?a:b,f=a.length<b.length?a:b;if(a===b)d+=100;else{d+=a.length===b.length?10:Math.floor(f.length/e.length*10);for(var g=0,h=f.length<100?f.length:100,i=10*h,j=0;h>j;j++)f[j].toLowerCase()===e[j].toLowerCase()&&(g+=10);if(g=Math.floor(g/i*70),d+=g,g=0,i=100,f>=6){var k=Math.floor(f.length/3),l=f.slice(0,k).toLowerCase(),m=e.slice(0,k).toLowerCase();l===m&&(g+=34),l=f.slice(0,2*k).toLowerCase(),m=e.slice(0,2*k).toLowerCase(),l===m&&(g+=33),l=f.slice(0,3*k).toLowerCase(),m=e.slice(0,3*k).toLowerCase(),l===m&&(g+=33),g=Math.floor(g/i*20),d+=g}}d>74?(c=G.response.getResponse("ok"),c.message="Items are similar.",c.results=arguments):(c=G.response.getResponse("error"),c.message="Items are not similar.",c.results=arguments)}return c},areLikeObjects:function(a,b){var c=G.data.isObject(a);if(!c.error&&(c=G.data.isObject(b),!c.error)){var d=0,e=0;for(var f in a)d++,a[f]===b[f]&&(e+=10);for(var f in b)d++,b[f]===a[f]&&(e+=10);e+=Math.floor(e/(10*d)*100),e>74?(c=G.response.getResponse("ok"),c.message="Objects are similar.",c.results=arguments):(c=G.response.getResponse("error"),c.message="Objects are not similar.",c.results=arguments)}return c},areLikeArrays:function(a,b){var c=G.data.isArray(a);if(!c.error&&(c=G.data.isArray(b),!c.error)){for(var d=0,e=0,f=0;f<a.length;f++)d++,a[f]===b[f]&&(e+=10);for(var g=0;g<a.length;g++)d++,b[g]===a[g]&&(e+=10);e+=Math.floor(e/(10*d)*100),e>74?(c=G.response.getResponse("ok"),c.message="Arrays are similar.",c.results=arguments):(c=G.response.getResponse("error"),c.message="Arrays are not similar.",c.results=arguments)}return c},copy:function(a){var b=this.isObject(a);if(!b.error){var c={};for(var d in a)c[d]=a[d];b=G.response.getResponse("ok"),b.message="Success, object created.",b.results=[c]}return b},propertyExist:function(a,b){var c=this.isObject(a);return c.error||(c=this.isString(b),c.error||(void 0!==a[b]?(c=G.response.getResponse("ok"),c.message="Success, property "+b+" exist.",c.results=[b]):(c=G.response.getResponse("error"),c.message="Property "+b+" does not exist.",c.results=[b]))),c}},G.createAPI=F,F(),G.init(),i}var b,c={},d=c.namespace||"deebs",e=c.user||"admin",f=c.debug||!1,g=c.superUser||!1,h=c.easyMode||!1,i={},j={tableNames:[{name:"tableNames",owner:"root"}]},k={lock:"_"+d+"_lock",id:"_"+d+"_id",unique:"_"+d+"_unique"};return b||(b=a()),window&&(window.$db=b),b}();